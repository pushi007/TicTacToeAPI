<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
	<changeSet author="pallavi" id="20161017-01">
		<createTable tableName="visitors_count" schemaName="moyadev">
			<column name="id" type="VARCHAR(36)">
				<constraints nullable="false" />
			</column>
			<column name="count" type="VARCHAR(100)" />
			<column name="last_updated" type="timestamp" />
			<column name="last_updated_by" type="VARCHAR(20)" />
		</createTable>
		<addPrimaryKey columnNames="id" tableName="visitors_count"
			schemaName="moyadev" />
	</changeSet>
	<changeSet author="pallavi" id="20161017-02">
		<dropUniqueConstraint constraintName="youthEnrollmentUniqueConstaint"
			schemaName="moyadev" tableName="youth_enrollment" />
	</changeSet>
	<changeSet author="Pallavi" id="20161017-03">
		<addUniqueConstraint catalogName="cat"
			columnNames="fullname, fathermothername, dob" constraintName="youthEnrollmentUniqueConstaint"
			schemaName="moyadev" tableName="youth_enrollment" />
	</changeSet>
	
	
	<!--Dropping views created for bulk upload -->
	 <changeSet author="vikas" id="dropView_incorrect_state_name_view">
	    <dropView schemaName="moyadev"
	            viewName="incorrect_state_name_view"/>
	</changeSet>	
	
	 <changeSet author="vikas" id="dropView_incorrect_district_name_view">
	    <dropView schemaName="moyadev"
	            viewName="incorrect_district_name_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_duplicate_record_view">
	    <dropView schemaName="moyadev"
	            viewName="duplicate_record_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_duplicate_temp_record_view">
	    <dropView schemaName="moyadev"
	            viewName="duplicate_temp_record_view"/>
	</changeSet>
	
	<!-- Dropping mis report views -->
	<changeSet author="vikas" id="dropView_district_wise_user_view">
	    <dropView schemaName="moyadev"
	            viewName="district_wise_user_view"/>
	</changeSet>	
	
	 <changeSet author="vikas" id="dropView_state_wise_user_view">
	    <dropView schemaName="moyadev"
	            viewName="state_wise_user_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_state_wise_youth_view">
	    <dropView schemaName="moyadev"
	            viewName="state_wise_youth_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_district_wise_youth_view">
	    <dropView schemaName="moyadev"
	            viewName="district_wise_youth_view"/>
	</changeSet>
	

	
	<changeSet author="pallavi" id="dropView">
		<dropView schemaName="moyadev" viewName="youth_enrollment_view" />
	</changeSet>

	 <changeSet author="pallavi" id="20161017-04">
		<addColumn schemaName="moyadev" tableName="youth_enrollment">
			<column name="approve_reject_status" type="varchar(12)" />
			<column name="approved_rejected_datetime" type="date" />
			<column name="approved_rejected_by" type="varchar(20)" />
			<column name="remark" type="varchar(100)" />
		</addColumn>
	</changeSet> 
	<changeSet author="pallavi" id="20161017-05">
		<modifyDataType columnName="dob" newDataType="date"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="mobile" newDataType="BigInt"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="pincode" newDataType="BigInt"
			tableName="youth_enrollment" schemaName="moyadev" />

		<!-- <modifyDataType columnName="last_updated" newDataType="date" tableName="youth_enrollment" 
			schemaName="moyadev" /> -->
		<modifyDataType columnName="bloodgroup" newDataType="varchar(5)"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="sex" newDataType="varchar(15)"
			tableName="youth_enrollment" schemaName="moyadev" />
		
		<modifyDataType columnName="status" newDataType="varchar(15)"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="aadhar_number" newDataType="varchar(15)"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="state" newDataType="varchar(50)"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="district" newDataType="varchar(50)"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="city_village" newDataType="varchar(30)"
			tableName="youth_enrollment" schemaName="moyadev" />
		<modifyDataType columnName="block" newDataType="varchar(30)"
			tableName="youth_enrollment" schemaName="moyadev" />
	</changeSet>



	<changeSet author="Pallavi" id="20161017-06">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="youth_enrollment_view">  
			SELECT youth.id,
           youth.aadhar_number,
           youth.fullname,
           youth.fathermothername,
           youth.sex,
           youth.dob,
           youth.address,
           youth.bloodgroup,
           youth.pincode,
           youth.fk_type,
           youth.fk_id,
           youth.landmark,   
           youth.state,
           youth.district,
           youth.email,
           youth.mobile,
           youth.city_village,
           youth.status, 
           youth.block, 
           youth.approve_reject_status,
           youth.approved_rejected_datetime,
           youth.last_updated_by,
           youth.approved_rejected_by,
           youth.remark,
           gs.geographic_name as state_name,
           gd.geographic_name as district_name        
      FROM moyadev.youth_enrollment youth left join  moyadev.geographic_data gs on youth.state = gs.ID left join moyadev.geographic_data gd on youth.district=gd.ID
      </createView>
	</changeSet>

	<changeSet author="Dinesh" id="20160913-01">
		<createTable tableName="content_management" schemaName="moyadev">
			<column name="id" type="CHAR(36)">
				<constraints nullable="false" />
			</column>
			<column name="organization_id" type="CHAR(36)" />
			<column name="parent_content" type="VARCHAR(50)" />
			<column name="content_type" type="VARCHAR(50)" />
			<column name="published_value" type="TEXT" />
			<column name="draft_value" type="TEXT" />
			<column name="created_date" type="VARCHAR(100)" />
			<column name="created_by" type="VARCHAR(100)" />
			<column name="last_updated" type="timestamp" />
			<column name="last_updated_by" type="VARCHAR(100)" />
		</createTable>
		<addPrimaryKey columnNames="id" tableName="content_management"
			schemaName="moyadev" />
	</changeSet>
	<changeSet author="pushpendra" id="20161013-05">
		<addColumn schemaName="moyadev" tableName="menu_per_role">
			<column name="view_flag" type="varchar(20)" />
		</addColumn>
		<addColumn schemaName="moyadev" tableName="menu_per_role">
			<column name="edit_flag" type="varchar(20)" />
		</addColumn>
		<addColumn schemaName="moyadev" tableName="menu_per_role">
			<column name="delete_flag" type="varchar(20)" />
		</addColumn>
	</changeSet>

	<changeSet author="Menu" id="20161014-01">
		<addUniqueConstraint catalogName="cat"
			columnNames="menu_name" constraintName="MenuUniqueConstaint"
			schemaName="moyadev" tableName="menu" />

		<addNotNullConstraint columnName="menu_name"
			catalogName="cat" constraintName="MenuUniqueConstaint" tableName="menu"
			schemaName="moyadev" />
	</changeSet>
</databaseChangeLog>
