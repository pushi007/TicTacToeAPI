<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
	<!-- <changeSet author="pushpendra" id="20161006-01">
		<addColumn schemaName="moyadev" tableName="geographic_data">
			<column name="status" type="varchar(100)" />
		</addColumn>
	</changeSet> -->
	
	
	
	
	   <changeSet author="Vikas" id="20161012-01">
		<createTable tableName="youth_enrollment_temp" schemaName="moyadev">
			<column name="id" type="CHAR(36)">
				<constraints nullable="false" />
			</column>
			<column name="aadhar_number" type="VARCHAR(100)" />
			<column name="fullname" type="VARCHAR(100)" />
			<column name="fathermothername" type="VARCHAR(100)" />
			<column name="sex" type="VARCHAR(100)" />
			<column name="dob" type="VARCHAR(100)" />
			<column name="address" type="VARCHAR(100)" />
			<column name="landmark" type="VARCHAR(100)" />
			<column name="state" type="VARCHAR(100)" />
			<column name="district" type="VARCHAR(100)" />
			<column name="state_name" type="VARCHAR(100)"/>
            <column name="district_name" type="VARCHAR(100)"/>
			<column name="block" type="VARCHAR(100)" />
			<column name="email" type="VARCHAR(100)" />
			<column name="mobile" type="VARCHAR(100)" />
			<column name="bloodgroup" type="VARCHAR(100)" />			
			<column name="city_village" type="VARCHAR(100)" />
			<column name="pincode" type="VARCHAR(100)" />
			<column name="fk_id" type="CHAR(36)" />
			<column name="fk_type" type="VARCHAR(100)" />
			<column name="status" type="VARCHAR(100)" />
			<column name="last_updated" type="timestamp" />
			<column name="last_updated_by" type="VARCHAR(100)" />
		</createTable>
		<addPrimaryKey columnNames="id" tableName="youth_enrollment_temp"
			schemaName="moyadev" />
		<createIndex indexName="fk_youth_enrollment_temp" tableName="youth_enrollment_temp"
			schemaName="moyadev">
			<column name="id" type="VARCHAR(100)" />
			</createIndex>
	</changeSet>
	
	<changeSet author="Vikas" id="20161012-02">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="incorrect_state_name_view">
			 SELECT 
			 youth.id,
			 youth.aadhar_number,
			 youth.fullname,
			 youth.fathermothername,
			 youth.sex,
			 youth.dob,
			 youth.address,
			 youth.landmark, 
			 youth.district,
			 youth.state, 
			 youth.block, 
			 youth.email, 
			 youth.mobile, 
			 youth.bloodgroup, 
			 youth.city_village, 
			 youth.pincode, 
			 youth.fk_id, 
			 youth.fk_type, 
			 youth.status, 
			 youth.last_updated, 
			 youth.last_updated_by, 
			 youth.state_name, 
			 youth.district_name
      FROM moyadev.youth_enrollment_temp youth WHERE youth.state is NULL
      </createView>
	</changeSet> 
	
	
	<changeSet author="Vikas" id="20161012-03">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="incorrect_district_name_view">
			 SELECT 
			 youth.id,
			 youth.aadhar_number,
			 youth.fullname,
			 youth.fathermothername,
			 youth.sex,
			 youth.dob,
			 youth.address,
			 youth.landmark, 
			 youth.district, 
			 youth.state,
			 youth.block, 
			 youth.email, 
			 youth.mobile, 
			 youth.bloodgroup, 
			 youth.city_village, 
			 youth.pincode, 
			 youth.fk_id, 
			 youth.fk_type, 
			 youth.status, 
			 youth.last_updated, 
			 youth.last_updated_by, 
			 youth.state_name, 
			 youth.district_name
      FROM moyadev.youth_enrollment_temp youth WHERE youth.district is NULL
      </createView>
	</changeSet> 
	 
	<changeSet author="liquibase-docs" id="dropUniqueConstraint-example">
		<dropUniqueConstraint constraintName="youthEnrollmentUniqueConstaint"
			schemaName="moyadev" tableName="youth_enrollment" />
	</changeSet>
	
	 <changeSet author="Vikas" id="20161012-04">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="duplicate_record_view">
			SELECT youth_temp.id,
			youth_temp.aadhar_number,
			youth_temp.fullname, 
			youth_temp.fathermothername,
			youth_temp.sex,
			youth_temp.dob,
			youth_temp.address,
            youth_temp.landmark,
            youth_temp.state,
            youth_temp.district,
            youth_temp.state_name,
            youth_temp.district_name,
            youth_temp.block,
            youth_temp.email,
            youth_temp.mobile,
            youth_temp.bloodgroup,
            youth_temp.city_village,
            youth_temp.pincode,
            youth_temp.fk_id,
            youth_temp.fk_type,
            youth_temp.status,
            youth_temp.last_updated,
            youth_temp.last_updated_by 
          FROM moyadev.youth_enrollment_temp youth_temp
          INNER JOIN moyadev.youth_enrollment youth on youth.fullname= youth_temp.fullname
                AND youth.fathermothername= youth_temp.fathermothername AND youth.dob= youth_temp.dob
      </createView>
	</changeSet> 
	
	
	
     <changeSet author="Vikas" id="20161012-05">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="duplicate_temp_record_view">
			SELECT count(youth.id),
			youth.fullname,
			youth.fathermothername,
			youth.dob
            from moyadev.youth_enrollment_temp youth
            group by youth.fullname,youth.fathermothername,youth.dob
            HAVING count(youth.id) > 1
      </createView>
	</changeSet> 
	
	
</databaseChangeLog>
