<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
	
	
	<!--Dropping views created for bulk upload -->
  <changeSet author="vikas" id="dropView_incorrect_state_name_view">
	    <dropView schemaName="moyadev"
	            viewName="incorrect_state_name_view"/>
	</changeSet>	
	
	 <changeSet author="vikas" id="dropView_incorrect_district_name_view">
	    <dropView schemaName="moyadev"
	            viewName="incorrect_district_name_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_duplicate_record_view">
	    <dropView schemaName="moyadev"
	            viewName="duplicate_record_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_duplicate_temp_record_view">
	    <dropView schemaName="moyadev"
	            viewName="duplicate_temp_record_view"/>
	</changeSet>  
	
	<!-- Dropping mis report views -->
     <changeSet author="vikas" id="dropView_district_wise_user_view">
	    <dropView schemaName="moyadev"
	            viewName="district_wise_user_view"/>
	</changeSet>	
	
	 <changeSet author="vikas" id="dropView_state_wise_user_view">
	    <dropView schemaName="moyadev"
	            viewName="state_wise_user_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_state_wise_youth_view">
	    <dropView schemaName="moyadev"
	            viewName="state_wise_youth_view"/>
	</changeSet>
	
	 <changeSet author="vikas" id="dropView_district_wise_youth_view">
	    <dropView schemaName="moyadev"
	            viewName="district_wise_youth_view"/>
	</changeSet>  
	

	
 <changeSet author="vikas" id="dropView">
		<dropView schemaName="moyadev" viewName="youth_enrollment_view" />
	</changeSet> 

	
	<!-- Chnage in youth_enrollment -->
	<changeSet author="vikas" id="20161019-01">
		 <modifyDataType columnName="last_updated" newDataType="varchar(100)" tableName="youth_enrollment" 
			schemaName="moyadev" /> 
			</changeSet>

     <changeSet author="vikas" id="20161019-11">
        <modifyDataType columnName="fullname" newDataType="VARCHAR(150)"
			tableName="youth_enrollment_temp" schemaName="moyadev" />
		<modifyDataType columnName="fathermothername"
			newDataType="VARCHAR(150)" tableName="youth_enrollment_temp" schemaName="moyadev" />
		<modifyDataType columnName="address" newDataType="VARCHAR(500)"
			tableName="youth_enrollment_temp" schemaName="moyadev" />
		<modifyDataType columnName="landmark" newDataType="VARCHAR(150)"
			tableName="youth_enrollment_temp" schemaName="moyadev" />
      </changeSet>

	<changeSet author="vikas" id="20161019-02">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="youth_enrollment_view">  
			SELECT youth.id,
           youth.aadhar_number,
           youth.fullname,
           youth.fathermothername,
           youth.sex,
           youth.dob,
           youth.address,
           youth.bloodgroup,
           youth.pincode,
           youth.fk_type,
           youth.fk_id,
           youth.landmark,   
           youth.state,
           youth.district,
           youth.email,
           youth.mobile,
           youth.city_village,
           youth.status, 
           youth.block, 
           youth.approve_reject_status,
           youth.approved_rejected_datetime,
           youth.last_updated_by,
           youth.approved_rejected_by,
           youth.remark,
           gs.geographic_name as state_name,
           gd.geographic_name as district_name        
      FROM moyadev.youth_enrollment youth left join  moyadev.geographic_data gs on youth.state = gs.ID left join moyadev.geographic_data gd on youth.district=gd.ID
      </createView>
	</changeSet>

<changeSet author="Vikas" id="20161019-03">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="incorrect_state_name_view">
			 SELECT 
			 youth.id,
			 youth.aadhar_number,
			 youth.fullname,
			 youth.fathermothername,
			 youth.sex,
			 youth.dob,
			 youth.address,
			 youth.landmark, 
			 youth.district,
			 youth.state, 
			 youth.block, 
			 youth.email, 
			 youth.mobile, 
			 youth.bloodgroup, 
			 youth.city_village, 
			 youth.pincode, 
			 youth.fk_id, 
			 youth.fk_type, 
			 youth.status, 
			 youth.last_updated, 
			 youth.last_updated_by, 
			 youth.state_name, 
			 youth.district_name
      FROM moyadev.youth_enrollment_temp youth WHERE youth.state is NULL
      </createView>
	</changeSet> 
	
	
	<changeSet author="Vikas" id="20161019-04">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="incorrect_district_name_view">
			 SELECT 
			 youth.id,
			 youth.aadhar_number,
			 youth.fullname,
			 youth.fathermothername,
			 youth.sex,
			 youth.dob,
			 youth.address,
			 youth.landmark, 
			 youth.district, 
			 youth.state,
			 youth.block, 
			 youth.email, 
			 youth.mobile, 
			 youth.bloodgroup, 
			 youth.city_village, 
			 youth.pincode, 
			 youth.fk_id, 
			 youth.fk_type, 
			 youth.status, 
			 youth.last_updated, 
			 youth.last_updated_by, 
			 youth.state_name, 
			 youth.district_name
      FROM moyadev.youth_enrollment_temp youth WHERE youth.district is NULL
      </createView>
	</changeSet> 
	
	
	 <changeSet author="Vikas" id="20161019-05">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="duplicate_record_view">
			SELECT youth_temp.id,
			youth_temp.aadhar_number,
			youth_temp.fullname, 
			youth_temp.fathermothername,
			youth_temp.sex,
			youth_temp.dob,
			youth_temp.address,
            youth_temp.landmark,
            youth_temp.state,
            youth_temp.district,
            youth_temp.state_name,
            youth_temp.district_name,
            youth_temp.block,
            youth_temp.email,
            youth_temp.mobile,
            youth_temp.bloodgroup,
            youth_temp.city_village,
            youth_temp.pincode,
            youth_temp.fk_id,
            youth_temp.fk_type,
            youth_temp.status,
            youth_temp.last_updated,
            youth_temp.last_updated_by 
          FROM moyadev.youth_enrollment_temp youth_temp
          INNER JOIN moyadev.youth_enrollment youth on youth.fullname= youth_temp.fullname
                AND youth.fathermothername= youth_temp.fathermothername AND youth.dob= youth_temp.dob
      </createView>
	</changeSet> 
	
	
	
     <changeSet author="Vikas" id="20161019-06">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="duplicate_temp_record_view">
			SELECT count(youth.id),
			youth.fullname,
			youth.fathermothername,
			youth.dob
            from moyadev.youth_enrollment_temp youth
            group by youth.fullname,youth.fathermothername,youth.dob
            HAVING count(youth.id) > 1
      </createView>
	</changeSet> 
 
 <changeSet author="Vikas" id="20161019-07">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="state_wise_user_view">
			SELECT  geo.geographic_name, count(usr.id),geo.id
            FROM  moyadev.geographic_data geo
            INNER JOIN  moyadev.USER usr
            ON usr.state=geo.id
            GROUP BY  geo.id
      </createView>
	</changeSet> 

	<changeSet author="Vikas" id="20161019-08">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="district_wise_user_view">
			SELECT  geo.geographic_name, count(usr.id),geo.id,geo.parent_geographic_id
            FROM  moyadev.geographic_data geo
            INNER JOIN  moyadev.USER usr
            ON usr.district=geo.id
            GROUP BY  geo.id
      </createView>
	</changeSet>

	 <changeSet author="Vikas" id="20161019-09">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="state_wise_youth_view">
			SELECT  geo.geographic_name, count(youth.id),geo.id
            FROM  moyadev.geographic_data geo
            INNER JOIN  moyadev.youth_enrollment youth
            ON youth.state=geo.id
            GROUP BY  geo.id
      </createView>
	</changeSet> 
	
	<changeSet author="Vikas" id="20161019-10">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="district_wise_youth_view">
			SELECT  geo.geographic_name, count(youth.id),geo.id,geo.parent_geographic_id
            FROM  moyadev.geographic_data geo
            INNER JOIN  moyadev.youth_enrollment youth
            ON youth.district=geo.id
            GROUP BY  geo.id
      </createView>
	</changeSet>
 
</databaseChangeLog>
