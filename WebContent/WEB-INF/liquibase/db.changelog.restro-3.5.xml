<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

	<changeSet author="Pushpendra" id="20161104-01">
		<createTable tableName="achievement_task" schemaName="moyadev">
			<column name="id" type="CHAR(36)">
				<constraints nullable="false" />
			</column>
			<column name="task_for_level" type="VARCHAR(100)" />
			<column name="task_for_organization" type="CHAR(36)" />
			<column name="task_for_user" type="VARCHAR(100)" />
			<column name="task_of_event" type="CHAR(36)" />
			<column name="task_for_district" type="CHAR(36)" />
			<column name="task_for_state" type="CHAR(36)" />
			<column name="remarks" type="VARCHAR(500)" />
			<column name="task_edited_by" type="VARCHAR(100)" />
			<column name="task_edited_date" type="timestamp" />
			<column name="task_status" type="VARCHAR(100)" />
		</createTable>
		<addPrimaryKey columnNames="id" tableName="achievement_task"
			schemaName="moyadev" />
		<addNotNullConstraint columnName="task_for_level"
			columnDataType="VARCHAR(100)" tableName="achievement_task"
			schemaName="moyadev" />
		<addNotNullConstraint columnName="task_for_organization"
			columnDataType="CHAR(36)" tableName="achievement_task" schemaName="moyadev" />
		<createIndex indexName="fk_achievement_task" tableName="achievement_task"
			schemaName="moyadev">
			<column name="task_for_level" type="VARCHAR(100)" />
		</createIndex>
	</changeSet>

	<changeSet author="Pushpendra" id="20161104-04">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="v_achievement_task"> SELECT t.id, t.task_for_organization, t.task_for_user, 
		t.task_of_event, t.task_for_district, t.task_for_state, t.task_status, wt.task_new_level 
		FROM moyadev.achievement_task t left join moyadev.workflow_task_mapping wt 
		on t.task_for_level = wt.workflow_for_level and t.task_status=wt.workflow_for_status</createView>
	</changeSet>

	<changeSet author="Pushpendra" id="20161107-01">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="achievement_task_view"> SELECT t.id, t.task_for_level, 
		t.task_for_organization, t.task_for_user, t.task_of_event, t.task_for_district, 
		t.task_for_state, t.remarks, t.task_status, t.task_edited_by, t.task_edited_date, 
		e.achievement_date, e.publish_date, e.achievement_title, g.geographic_name 
		as task_state_name, gd.geographic_name as task_district_name FROM moyadev.achievement_task 
		t left join moyadev.achievement e on t.task_of_event = e.id left join moyadev.geographic_data 
		g on t.task_for_state=g.id left join moyadev.geographic_data gd on t.task_for_district=gd.id</createView>
	</changeSet>

	<changeSet author="Pushpendra" id="20161104-02">
		<createTable tableName="photo_gallery_task" schemaName="moyadev">
			<column name="id" type="CHAR(36)">
				<constraints nullable="false" />
			</column>
			<column name="task_for_level" type="VARCHAR(100)" />
			<column name="task_for_organization" type="CHAR(36)" />
			<column name="task_for_user" type="VARCHAR(100)" />
			<column name="task_of_event" type="CHAR(36)" />
			<column name="task_for_district" type="CHAR(36)" />
			<column name="task_for_state" type="CHAR(36)" />
			<column name="remarks" type="VARCHAR(500)" />
			<column name="task_edited_by" type="VARCHAR(100)" />
			<column name="task_edited_date" type="timestamp" />
			<column name="task_status" type="VARCHAR(100)" />
		</createTable>
		<addPrimaryKey columnNames="id" tableName="photo_gallery_task"
			schemaName="moyadev" />
		<addNotNullConstraint columnName="task_for_level"
			columnDataType="VARCHAR(100)" tableName="photo_gallery_task"
			schemaName="moyadev" />
		<addNotNullConstraint columnName="task_for_organization"
			columnDataType="CHAR(36)" tableName="photo_gallery_task" schemaName="moyadev" />
		<createIndex indexName="fk_photo_gallery_task" tableName="photo_gallery_task"
			schemaName="moyadev">
			<column name="task_for_level" type="VARCHAR(100)" />
		</createIndex>
	</changeSet>
	<changeSet author="Pushpendra" id="20161104-03">
		<createTable tableName="video_gallery_task" schemaName="moyadev">
			<column name="id" type="CHAR(36)">
				<constraints nullable="false" />
			</column>
			<column name="task_for_level" type="VARCHAR(100)" />
			<column name="task_for_organization" type="CHAR(36)" />
			<column name="task_for_user" type="VARCHAR(100)" />
			<column name="task_of_event" type="CHAR(36)" />
			<column name="task_for_district" type="CHAR(36)" />
			<column name="task_for_state" type="CHAR(36)" />
			<column name="remarks" type="VARCHAR(500)" />
			<column name="task_edited_by" type="VARCHAR(100)" />
			<column name="task_edited_date" type="timestamp" />
			<column name="task_status" type="VARCHAR(100)" />
		</createTable>
		<addPrimaryKey columnNames="id" tableName="video_gallery_task"
			schemaName="moyadev" />
		<addNotNullConstraint columnName="task_for_level"
			columnDataType="VARCHAR(100)" tableName="video_gallery_task"
			schemaName="moyadev" />
		<addNotNullConstraint columnName="task_for_organization"
			columnDataType="CHAR(36)" tableName="video_gallery_task" schemaName="moyadev" />
		<createIndex indexName="fk_video_gallery_task" tableName="video_gallery_task"
			schemaName="moyadev">
			<column name="task_for_level" type="VARCHAR(100)" />
		</createIndex>
	</changeSet>


	<changeSet author="Pushpendra" id="20161104-04">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="v_photo_gallery_task"> SELECT t.id, t.task_for_organization, 
		t.task_for_user, t.task_of_event, t.task_for_district, t.task_for_state, 
		t.task_status, wt.task_new_level FROM moyadev.photo_gallery_task t left join 
		moyadev.workflow_task_mapping wt on t.task_for_level = wt.workflow_for_level 
		and t.task_status=wt.workflow_for_status</createView>
	</changeSet>
	<changeSet author="Pushpendra" id="20161104-05">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="v_video_gallery_task"> SELECT t.id, t.task_for_organization, 
		t.task_for_user, t.task_of_event, t.task_for_district, t.task_for_state, 
		t.task_status, wt.task_new_level FROM moyadev.video_gallery_task t left join 
		moyadev.workflow_task_mapping wt on t.task_for_level = wt.workflow_for_level 
		and t.task_status=wt.workflow_for_status</createView>
	</changeSet>

	<changeSet author="Pushpendra" id="20161107-01">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="photo_gallery_task_view"> SELECT t.id, t.task_for_level, 
		t.task_for_organization, t.task_for_user, t.task_of_event, t.task_for_district, 
		t.task_for_state, t.remarks, t.task_status, t.task_edited_by, t.task_edited_date, 
		e.created_date, e.publish_date, e.album_name,e.album_type, g.geographic_name 
		as task_state_name, gd.geographic_name as task_district_name FROM moyadev.photo_gallery_task 
		t left join moyadev.gallery_album e on t.task_of_event = e.id left join moyadev.geographic_data 
		g on t.task_for_state=g.id left join moyadev.geographic_data gd on t.task_for_district=gd.id</createView>
	</changeSet>
	<changeSet author="Pushpendra" id="20161107-02">
		<createView replaceIfExists="true" schemaName="moyadev"
			viewName="video_gallery_task_view"> SELECT t.id, t.task_for_level, 
		t.task_for_organization, t.task_for_user, t.task_of_event, t.task_for_district, 
		t.task_for_state, t.remarks, t.task_status, t.task_edited_by, t.task_edited_date, 
		e.achievement_date, e.publish_date, e.achievement_title, g.geographic_name 
		as task_state_name, gd.geographic_name as task_district_name FROM moyadev.video_gallery_task 
		t left join moyadev.gallery_items e on t.task_of_event = e.id left join moyadev.geographic_data 
		g on t.task_for_state=g.id left join moyadev.geographic_data gd on t.task_for_district=gd.id 
		left join moyadev.gallery_album ga on e.parent_id=ga.id and ga.album_type='Videos'</createView>
	</changeSet>
	
</databaseChangeLog> 